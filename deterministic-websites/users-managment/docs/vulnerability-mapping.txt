SQL INJECTION HONEYPOT - VULNERABILITY MAPPING
===============================================

This honeypot website exposes a SQL Injection vulnerability.

VULNERABILITY EXPOSED
---------------------
Vulnerability ID: 1
Name: "SQL Injection"
Description: User input concatenated directly into SQL queries without sanitization
Location: data/vulnarabilities.json

HOW THE VULNERABILITY IS EXPOSED
---------------------------------

1. Search Form - Direct SQL Concatenation
   - File: app/api/search/route.ts
   - Method: User input from search form is directly concatenated into SQL query
   - Line: 30 - const vulnerableQuery = `SELECT * FROM users WHERE username = '${username}' AND active = 1`
   - Vulnerability: The username parameter is inserted directly into the SQL string without sanitization or parameterization
   - Visibility: Vulnerable code is in the API route handler

2. POST Request Handler
   - File: app/api/search/route.ts
   - Method: POST endpoint accepts JSON body with username field
   - Line: 20 - const username = body.username || ''
   - Vulnerability: User input is extracted and immediately used in SQL query construction
   - No input validation or sanitization is performed

3. Frontend Search Form
   - File: app/components/SearchForm.tsx
   - Method: React form component that sends user input to vulnerable API
   - Line: 18 - body: JSON.stringify({ username })
   - Visibility: User can input any SQL injection payload through the form

EXAMPLE SQL INJECTION PAYLOADS
-------------------------------
The following payloads can be used to test the vulnerability:

1. Basic Injection: ' OR '1'='1
   - Bypasses WHERE clause, returns all records

2. Comment Injection: ' OR '1'='1'--
   - Uses SQL comment to ignore rest of query

3. UNION Injection: ' UNION SELECT * FROM users--
   - Attempts to union with additional data

4. Boolean Injection: ' OR 1=1--
   - Classic boolean-based SQL injection

MITRE ATT&CK TECHNIQUE MAPPINGS
--------------------------------
From: lib/honeypot-utils.ts (getTechniqueId function, line 75)

Vulnerability Type: sql-injection-attempt
  → MITRE Technique: T1190 (Exploit Public-Facing Application)
  → Description: Attacker injects SQL code through user input to exploit the application
  → Tactic: Initial Access
  → URL: https://attack.mitre.org/techniques/T1190/

DETECTION LOGIC
---------------
The honeypot detects SQL injection attempts by:

1. Pattern Matching (lib/honeypot-utils.ts, checkSqlInjection function)
   - Detects SQL metacharacters: ', --, UNION, OR 1=1
   - Identifies SQL keywords: SELECT, INSERT, UPDATE, DELETE, DROP
   - Catches command chaining: ; followed by SQL commands
   - Monitors for SQL comments: /* */ and --

2. Suspicious Pattern Detection
   - Multiple suspicious patterns in single input
   - Combination of quotes and SQL keywords
   - Command separators with SQL operations

3. Logging (lib/honeypot-utils.ts, logSqlInjectionAttempt function)
   - Logs all injection attempts to Supabase
   - Tracks attacker IP address
   - Records the SQL payload and vulnerable query
   - Generates session IDs for correlation

DETECTION SCENARIOS
-------------------
The honeypot logs three types of attempts:

1. Injection Detected (sql-injection-attempt)
   - Clear SQL injection patterns found
   - Logs the payload and vulnerable query
   - Returns simulated successful injection response

2. Suspicious Input (sql-injection-suspicious)
   - Multiple suspicious patterns detected
   - May indicate attempted injection
   - Logs for further analysis

3. Normal Input (sql-injection-normal)
   - No injection patterns detected
   - Still logged for baseline analysis

FILES INVOLVED
--------------
- app/api/search/route.ts: Vulnerable API endpoint with SQL injection
  - Line 20: Extracts username from request body
  - Line 30: Constructs vulnerable SQL query with direct concatenation
  - Line 33: Logs injection attempts

- app/components/SearchForm.tsx: Frontend form component
  - Line 18: Sends user input to vulnerable API
  - Displays search results to user

- lib/honeypot-utils.ts: Detection and logging logic
  - checkSqlInjection(): Detects SQL injection patterns
  - logSqlInjectionAttempt(): Logs attempts to Supabase
  - getTechniqueId(): Maps to MITRE ATT&CK T1190

- lib/honeypot-config.ts: Configuration
  - Database and table names for query construction

- lib/supabase.ts: Database client for logging

SECURITY NOTES
--------------
⚠️  WARNING: This code is intentionally vulnerable for honeypot purposes.
    DO NOT use this pattern in production code!

✅  Secure alternatives:
    - Use parameterized queries / prepared statements
    - Input validation and sanitization
    - Use ORM libraries with built-in protection
    - Implement least privilege database access

