{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///Users/shayyahal/canary/deterministic-websites/users-managment/components/UserTracker.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect } from 'react';\nimport { usePathname, useSearchParams } from 'next/navigation';\n\nexport default function UserTracker() {\n  const pathname = usePathname();\n  const searchParams = useSearchParams();\n\n  useEffect(() => {\n    // Track page views\n    trackEvent('page_view', {\n      path: pathname,\n      search: searchParams.toString(),\n    });\n  }, [pathname, searchParams]);\n\n  useEffect(() => {\n    // Single event listener for ALL interactions\n    const trackInteraction = (e: Event) => {\n      const target = e.target as HTMLElement;\n\n      // Get element details\n      const data: any = {\n        type: e.type,\n        tagName: target.tagName,\n        id: target.id,\n        className: target.className,\n        text: target.textContent?.slice(0, 100), // First 100 chars\n        timestamp: Date.now(),\n        path: pathname,\n      };\n\n      // Capture data attributes (for custom tracking)\n      Object.keys(target.dataset).forEach(key => {\n        data[`data_${key}`] = target.dataset[key];\n      });\n\n      // Form-specific data\n      if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA') {\n        data.inputType = (target as HTMLInputElement).type;\n        data.inputName = (target as HTMLInputElement).name;\n        // Don't log actual values for privacy\n      }\n\n      // Button/link specific\n      if (target.tagName === 'BUTTON' || target.tagName === 'A') {\n        data.href = (target as HTMLAnchorElement).href;\n      }\n\n      trackEvent(`user_${e.type}`, data);\n    };\n\n    // Listen to multiple event types\n    const events = ['click', 'submit', 'change', 'focus', 'input'];\n    events.forEach(eventType => {\n      document.addEventListener(eventType, trackInteraction, true);\n    });\n\n    // Track mouse movement (sampled)\n    let lastMouseTrack = 0;\n    const trackMouse = (e: MouseEvent) => {\n      const now = Date.now();\n      if (now - lastMouseTrack > 1000) { // Sample every second\n        trackEvent('mouse_position', {\n          x: e.clientX,\n          y: e.clientY,\n          path: pathname,\n        });\n        lastMouseTrack = now;\n      }\n    };\n    document.addEventListener('mousemove', trackMouse);\n\n    // Track scroll depth\n    let maxScroll = 0;\n    const trackScroll = () => {\n      const scrollHeight = document.body.scrollHeight - window.innerHeight;\n      if (scrollHeight <= 0) return; // Avoid division by zero\n\n      const scrollPercent = Math.round(\n        (window.scrollY / scrollHeight) * 100\n      );\n      if (scrollPercent > maxScroll) {\n        maxScroll = scrollPercent;\n        trackEvent('scroll_depth', { depth: scrollPercent, path: pathname });\n      }\n    };\n    window.addEventListener('scroll', trackScroll);\n\n    // Cleanup\n    return () => {\n      events.forEach(eventType => {\n        document.removeEventListener(eventType, trackInteraction, true);\n      });\n      document.removeEventListener('mousemove', trackMouse);\n      window.removeEventListener('scroll', trackScroll);\n    };\n  }, [pathname]);\n\n  return null;\n}\n\n// Helper to send events to Supabase\nasync function trackEvent(event: string, data: any) {\n  try {\n    await fetch('/api/track', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        event,\n        data,\n        session_id: getSessionId(),\n        user_id: getUserId(), // If you have auth\n        timestamp: new Date().toISOString(),\n      }),\n    });\n  } catch (error) {\n    console.error('Tracking failed:', error);\n  }\n}\n\nfunction getSessionId() {\n  let sessionId = sessionStorage.getItem('session_id');\n  if (!sessionId) {\n    sessionId = crypto.randomUUID();\n    sessionStorage.setItem('session_id', sessionId);\n  }\n  return sessionId;\n}\n\nfunction getUserId() {\n  // Get from localStorage if user is logged in\n  return localStorage.getItem('user_id') || null;\n}\n"],"names":[],"mappings":"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"}}]
}