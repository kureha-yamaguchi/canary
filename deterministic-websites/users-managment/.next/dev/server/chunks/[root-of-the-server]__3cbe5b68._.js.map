{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/jacobdavies/canary/deterministic-websites/users-managment/lib/supabase.ts"],"sourcesContent":["import { createClient, SupabaseClient } from '@supabase/supabase-js';\n\n// Server-side only - no NEXT_PUBLIC prefix\n// Use service role key for server-side operations that bypass RLS\nconst supabaseUrl = process.env.SUPABASE_URL;\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\n// Only create Supabase client if environment variables are configured\nexport const supabase: SupabaseClient | null = \n  supabaseUrl && supabaseServiceKey\n    ? createClient(supabaseUrl, supabaseServiceKey)\n    : null;\n\n// Database types for vulnerability logging\nexport interface VulnerabilityLog {\n  id?: string;\n  base_url: string;\n  path?: string;\n  vulnerability_type: string;\n  technique_id: string;\n  timestamp?: string;\n  attacker_id: string;\n  session_id: string;\n}\n\n"],"names":[],"mappings":";;;;AAAA;;AAEA,2CAA2C;AAC3C,kEAAkE;AAClE,MAAM,cAAc,QAAQ,GAAG,CAAC,YAAY;AAC5C,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB;AAGzD,MAAM,WACX,eAAe,qBACX,IAAA,yMAAY,EAAC,aAAa,sBAC1B"}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///Users/jacobdavies/canary/deterministic-websites/users-managment/app/api/track/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { supabase } from '@/lib/supabase';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { event, data, session_id, user_id, timestamp } = body;\n\n    // Extract attacker IP\n    const attackerId =\n      request.headers.get('x-forwarded-for')?.split(',')[0] ||\n      request.headers.get('x-real-ip') ||\n      'unknown';\n\n    // Determine base_url\n    const url = new URL(request.url);\n    const baseUrl = process.env.VERCEL_PROJECT_PRODUCTION_URL\n      ? `https://${process.env.VERCEL_PROJECT_PRODUCTION_URL}`\n      : url.origin;\n\n    const payload = {\n      base_url: baseUrl,\n      event_type: event,\n      event_data: data,\n      session_id,\n      user_id,\n      attacker_id: attackerId,\n      timestamp,\n    };\n\n    if (!supabase) {\n      console.warn('[Tracking] Supabase not configured - skipping log');\n      console.log('[Tracking] Would have logged:', payload);\n      return NextResponse.json({ success: true });\n    }\n\n    console.log('[Tracking] Inserting event:', event);\n    const { error } = await supabase.from('events').insert(payload);\n\n    if (error) {\n      console.error('[Tracking] Failed to log to Supabase:', error);\n      return NextResponse.json({ error: 'Failed to log event' }, { status: 500 });\n    }\n\n    console.log('[Tracking] Successfully logged event:', event);\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error('[Tracking] Error:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,UAAU,EAAE,OAAO,EAAE,SAAS,EAAE,GAAG;QAExD,sBAAsB;QACtB,MAAM,aACJ,QAAQ,OAAO,CAAC,GAAG,CAAC,oBAAoB,MAAM,IAAI,CAAC,EAAE,IACrD,QAAQ,OAAO,CAAC,GAAG,CAAC,gBACpB;QAEF,qBAAqB;QACrB,MAAM,MAAM,IAAI,IAAI,QAAQ,GAAG;QAC/B,MAAM,UAAU,QAAQ,GAAG,CAAC,6BAA6B,GACrD,CAAC,QAAQ,EAAE,QAAQ,GAAG,CAAC,6BAA6B,EAAE,GACtD,IAAI,MAAM;QAEd,MAAM,UAAU;YACd,UAAU;YACV,YAAY;YACZ,YAAY;YACZ;YACA;YACA,aAAa;YACb;QACF;QAEA,IAAI,CAAC,6HAAQ,EAAE;YACb,QAAQ,IAAI,CAAC;YACb,QAAQ,GAAG,CAAC,iCAAiC;YAC7C,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAK;QAC3C;QAEA,QAAQ,GAAG,CAAC,+BAA+B;QAC3C,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,6HAAQ,CAAC,IAAI,CAAC,UAAU,MAAM,CAAC;QAEvD,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,yCAAyC;YACvD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,QAAQ,GAAG,CAAC,yCAAyC;QACrD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}